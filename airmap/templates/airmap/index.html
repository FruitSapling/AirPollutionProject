<!DOCTYPE html>
{% load leaflet_tags %}
{% load geojson_tags %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Air Quality Map</title>
    {% leaflet_js %}
    {% leaflet_css %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>
<body>
<style> .leaflet-container { height: 90%;} </style>

<div style="height:800px"> {% leaflet_map "main" callback="ourfunction" %} </div>

<script type="text/javascript">
    function ourfunction(map, options) {
        var dataurl = '{% url "airmap:data" %}';
        $.getJSON(dataurl, function(data){
            var geojsonMarkerOptions = {
                radius: 8,
                fillColor: "#ff7800",
                color: "#000",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.8
            };
            L.geoJson(data, {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, geojsonMarkerOptions);
            }
        }).addTo(map);
        });
    }
    function main_map_init (map, options) {
        // Use Leaflet API here
        var geojsonFeature = {
            "type": "Feature",
            "properties": {
                "name": "University of Exeter",
                "amenity": "Uni",
                "popupContent": "Beautiful campus."
            },
            "geometry": {
                "type": "Point",
                "coordinates": [-3.5344, 50.7365]
            }
        };
        var geojsonFeature2 = {
            "type": "Feature",
            "properties": {
                "name": "Coors Field",
                "amenity": "Baseball Stadium",
                "popupContent": "This is where the Rockies play!"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [-3.5346, 50.7367]
            }
        };

        var geojsonMarkerOptions = {
            radius: 8,
            fillColor: "#ff7800",
            color: "#000",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
        };

        L.geoJSON(geojsonFeature, {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, geojsonMarkerOptions);
            }
        }).addTo(map);
    }
</script>

<script type="text/javascript">
      var collection = {{ qs_results|geojsonfeature|safe }};
      function map_init(map, options) {
          L.geoJson(collection).addTo(map);
      }
</script>

Hello

</body>
</html>